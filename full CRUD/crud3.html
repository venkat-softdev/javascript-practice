<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD in javascript</title>
</head>
<style>
    *{
        font-family: 'poppins';
    }
    .box{
        max-width: 900px;
        margin: auto;
        padding: 20px;
    }
    form{
         margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    form input{
         margin: 5px;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    form button{
        padding: 8px 15px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .tablebox{
         overflow-x: auto;
    }
    table{
        width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table,th,td{
        border: 1px solid #ccc;
    }
    th,td{
        padding: 10px;
      text-align: left;
    }
    th{
        background-color: #f4f4f4;
    }
    .action-btn{
         display: flex;
      gap: 10px; 
    }
    .action-btn button {
         width: 70px; /* Consistent width for buttons */
      background-color: #007bff;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .delete-btn{
        background-color: #dc3545;
    }
    .no-tasks {
      text-align: center;
      font-size: 16px;
      color: #888;
      margin-top: 20px;
    }
</style>
<body>
    <div class="box">
        <h2>Crud in javascript </h2>
    <!-- form  -->
     <form action="" id="form">
        <input type="text" id="name" name="name" placeholder="Name" required>
        <input type="email" id="email" name="email" placeholder="Email" required>
        <input type="tel" id="phone" name="phone" placeholder="Phone" required>
        <button type="submit">Add Task</button>
     </form>
     <!-- form end -->

     <!-- table start -->
      <div class="tablebox">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tbody">
             
            </tbody>
        </table>
        <div class="no-tasks" id="notaskmessage">
            No tasks found.Add some Task!
        </div>
      </div>
    </div>
</body>

<script>
    let tasks=[];
    const form=document.querySelector("#form");
    const name=document.querySelector("#name");
    const email=document.querySelector("#email");
    const phone=document.querySelector("#phone");
    const submitbtn=document.querySelector("button");
    let isEditing=false;
    let currentTaskId=null;

    // fetch function starting 

    function fetchtask() {
        fetch("https://694ce310da5ddabf0037bc1a.mockapi.io/animals/user")
        .then((res)=>{
            return res.json()
        })
        .then((data)=>{
            tasks=data;
            renderfun()
            alert("Fetch Added successfully")
        })
        .catch((error)=>{
            console.log(error);
            
        })
    }

    // renderfunction starting 
    function renderfun() {
        if (tasks.length===0) {
            notaskmessage.style.display="block";
            tbody.innerHtML=" ";
        } else {
            notaskmessage.style.display="none";
            

            let rows=""

            tasks.forEach((task)=>{
                rows+=`
                <tr>
                  <td>${task.id}</td>
                  <td>${task.name}</td>
                  <td>${task.email}</td>
                  <td>${task.phone}</td>
                  <td>
                    <div class="action-btn">
                     <button onclick="editTask('${task.id}')">Edit</button>
                     <button class="delete-btn" onclick="deleteTask('${task.id}')">
                        Delete</button>
                  </div>
                  </td>
                  </tr>     
                `;
            })
            tbody.innerHtML=rows
        }
    }


    // Add or Update a Task 

  form.addEventListener("submit",(event)=>{
    event.preventDefault();

    const name=document.querySelector("#name").value;
    const email=document.querySelector("#email").value;
    const phone=document.querySelector("#phone").value;

    if (isEditing) {
        
        // update Task 
        fetch(`https://694ce310da5ddabf0037bc1a.mockapi.io/animals/user/${currentTaskId}`,{
            method:"PUT",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({name,email,phone}),
        })
        .then((res)=>{
            return res.json()
        })
        .then((updateTask)=>{
            tasks=tasks.map((task)=>{
                task.id===updateTask.id?updateTask:task
            });
            renderfun()
            resetform()
            alert("Task Updated sucessfully")
        })
        .catch((error)=>{
            console.log(error);
            
        })
    } else {
        // Add Task 

        fetch("https://694ce310da5ddabf0037bc1a.mockapi.io/animals/user",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({name,email,phone})
        })
        .then((res)=>{
            return res.json()
        })
        .then((newtask)=>{
            tasks.push(newtask)
            renderfun()
            resetform()
            alert("Task Added successfully")
        })
        .catch((error)=>{
            console.log(error);
            
        })
    }
  });

  // edit a Task 

  function editTask(id) {
    const task=tasks.find((t)=>{
        return t.id===id
    })
    if(!task) return;
    isEditing=true;
    currentTaskId=id;
    submitbtn.textContent="Edit Task";
    document.querySelector("#name").value=task.name;
    document.querySelector("#email").value=task.email;
    document.querySelector("#phone").value=task.phone;
  }

  // delete a task 

  function deleteTask(id) {
    fetch(`https://694ce310da5ddabf0037bc1a.mockapi.io/animals/user/${id}`,{
        method:"DELETE",
    })
    .then((res)=>{
        if (res.ok) {
            tasks=tasks.filter((task)=>{
                return task.id!==id
            })
            renderfun()
            alert("task deleted successfully")
        }
    })
    .catch((error)=>{
        console.log(error);
        
    })
    
  }

  // reset form 
  function resetform() {
    isEditing=false;
    currentTaskId=null;
    form.reset()
    submitbtn.textContent="Add Task"
  }


  // fetch on page load 
  fetchtask()
</script>
</html>